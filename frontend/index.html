<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>D&D Companion</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
</head>
<body>

    <div id="auth-container" class="auth-overlay">
        <div class="auth-form-container">
            <form id="login-form">
                <h2>Вход в D&D Companion</h2>
                <input type="text" id="loginUsername" placeholder="Имя пользователя" autocomplete="username" required>
                <input type="password" id="loginPassword" placeholder="Пароль" autocomplete="current-password" required>
                <button id="loginBtn" type="submit">Войти</button>
                <p>Нет аккаунта? <a href="#" id="showRegister">Зарегистрироваться</a></p>
            </form>
            <form id="register-form" class="hidden">
                <h2>Регистрация</h2>
                <input type="text" id="registerUsername" placeholder="Имя пользователя" autocomplete="username" required>
                <input type="password" id="registerPassword" placeholder="Пароль" autocomplete="new-password" required>
                <button id="registerBtn" type="submit">Создать аккаунт</button>
                <p>Уже есть аккаунт? <a href="#" id="showLogin">Войти</a></p>
            </form>
            <p id="authMessage" class="auth-message"></p>
        </div>
    </div>

    <div id="main-app" class="hidden">
        <aside class="sidebar left-sidebar">
            <div id="combat-tracker" class="sidebar-panel">
                <h3>Бой</h3>
                <div id="combat-controls">
                    <button id="startCombatBtn">Начать бой</button>
                    <button id="nextTurnBtn" class="hidden">След. ход</button>
                    <button id="endCombatBtn" class="hidden">Завершить</button>
                </div>
                <ul id="initiativeTracker"></ul>
                <div id="add-npc-form" class="hidden">
                    <input type="text" id="npcNameInput" placeholder="Имя NPC">
                    <input type="number" id="npcInitiativeInput" placeholder="Init">
                    <button id="addNpcBtn">+</button>
                </div>
            </div>
            
            <div id="attack-spells-panel" class="sidebar-panel">
                <h3>Атаки и Заклинания</h3>
                <div id="combat-actions-list">
                    <div id="attacks-for-combat"></div>
                    <div id="spells-for-combat"></div>
                </div>
            </div>

            <div id="inventory-panel" class="sidebar-panel">
                <h3>Снаряжение</h3>
                <div id="equipment-for-combat"></div>
            </div>
            
        </aside>

        <main class="main-content">
            <div id="map-container">
                <canvas id="battleMap"></canvas>
            </div>
            <div id="map-toolbar">
                 <div class="toolbar-group">
                    <label for="mapBackground">URL фона:</label>
                    <input type="text" id="mapBackground" placeholder="https://example.com/map.jpg">
                    <button id="loadMapBackground">Выбрать</button>
                </div>
                <div class="toolbar-group">
                    <label for="gridSize">Сетка:</label>
                    <input type="number" id="gridSize" value="50">
                </div>
                 <div id="user-panel">
                    <span id="usernameDisplay"></span>
                    <button id="logoutBtn">Выйти</button>
                </div>
            </div>
        </main>

        <aside class="sidebar right-sidebar">
            <div id="character-manager" class="sidebar-panel">
                <h3>Персонажи</h3>
                <select id="characterSelector"></select>
                <div class="char-buttons">
                    <button id="loadCharacterBtn">Загрузить</button>
                    <button id="newCharacterBtn">Новый</button>
                    <button id="deleteCharacterBtn">Удалить</button>
                </div>
                <button id="open-sheet-btn">Открыть лист персонажа</button>
            </div>

            <div id="event-log" class="sidebar-panel">
                <h3>Лог событий</h3>
                <div id="eventLogDisplay"></div>
                <div class="log-input-area">
                    <input type="text" id="eventLogInput" placeholder="Сообщение или /roll 1d20">
                    <button id="eventLogSendBtn">➢</button>
                </div>
            </div>
        </aside>
    </div>

    <div id="sheet-modal" class="modal-overlay hidden">
        <div class="sheet-modal-content">
            <button id="close-sheet-btn" class="close-btn">&times;</button>
            <div id="character-sheet-container">
                </div>
        </div>
    </div>

    <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
    <script src="js/main.js"></script>
</body>
</html>