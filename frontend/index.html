<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>D&D 5e Character Sheet</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
</head>
<body>

    <div id="auth-container" class="auth-overlay">
        <div class="auth-form-container">
            <div id="login-form">
                <h2>Вход</h2>
                <input type="text" id="loginUsername" placeholder="Имя пользователя" autocomplete="username">
                <input type="password" id="loginPassword" placeholder="Пароль" autocomplete="current-password">
                <button id="loginBtn">Войти</button>
                <p>Нет аккаунта? <a href="#" id="showRegister">Зарегистрироваться</a></p>
            </div>
            <div id="register-form" class="hidden">
                <h2>Регистрация</h2>
                <input type="text" id="registerUsername" placeholder="Имя пользователя" autocomplete="username">
                <input type="password" id="registerPassword" placeholder="Пароль" autocomplete="new-password">
                <button id="registerBtn">Создать аккаунт</button>
                <p>Уже есть аккаунт? <a href="#" id="showLogin">Войти</a></p>
            </div>
            <p id="authMessage" class="auth-message"></p>
        </div>
    </div>

    <div id="main-app" class="hidden">
        <div class="character-manager">
            <div id="user-panel">
                <span id="usernameDisplay"></span>
                <button id="logoutBtn">Выйти</button>
            </div>
            <select id="characterSelector"></select>
            <button id="loadCharacterBtn">Загрузить</button>
            <button id="newCharacterBtn">Новый персонаж</button>
            <button id="deleteCharacterBtn">Удалить</button>
        </div>

        <div id="app" class="character-sheet">
            <header class="sheet-header">
                <div class="header-section">
                    <span class="label">ИМЯ ПЕРСОНАЖА</span>
                    <input type="text" id="characterName" class="character-name-input" value="Либериус">
                </div>
                <div class="header-section">
                    <span class="label">КЛАСС И УРОВЕНЬ</span>
                    <p id="characterClassLevel">Волшебник 1 уровня</p>
                </div>
                <div class="header-section">
                    <span class="label">ПРЕДЫСТОРИЯ</span>
                    <p id="characterBackground">Магорождённый</p>
                </div>
                <div class="header-section">
                    <span class="label">ИМЯ ИГРОКА</span>
                    <p id="characterPlayerName">Лев Жифарский</p>
                </div>
                <div class="header-section">
                    <span class="label">РАСА</span>
                    <p id="characterRace">Полуэльф</p>
                </div>
                <div class="header-section">
                    <span class="label">МИРОВОЗЗРЕНИЕ</span>
                    <p id="characterAlignment">Нейтрально добрый</p>
                </div>
                <div class="header-section">
                    <span class="label">ОЧКИ ОПЫТА</span>
                    <p id="characterExperience">0</p>
                </div>
            </header>

            <main class="sheet-main">
                <section class="abilities-section">
                    <h2>Характеристики</h2>
                    <div class="ability-score">
                        <span class="label">СИЛА</span>
                        <input type="number" id="strengthScore" class="score-input" value="10">
                        <input type="text" id="strengthModifier" class="modifier-input" value="0" readonly>
                    </div>
                    <div class="ability-score">
                        <span class="label">ЛОВКОСТЬ</span>
                        <input type="number" id="dexterityScore" class="score-input" value="10">
                        <input type="text" id="dexterityModifier" class="modifier-input" value="0" readonly>
                    </div>
                    <div class="ability-score">
                        <span class="label">ТЕЛОСЛОЖЕНИЕ</span>
                        <input type="number" id="constitutionScore" class="score-input" value="10">
                        <input type="text" id="constitutionModifier" class="modifier-input" value="0" readonly>
                    </div>
                    <div class="ability-score">
                        <span class="label">ИНТЕЛЛЕКТ</span>
                        <input type="number" id="intellScore" class="score-input" value="10">
                        <input type="text" id="intellModifier" class="modifier-input" value="0" readonly>
                    </div>
                    <div class="ability-score">
                        <span class="label">МУДРОСТЬ</span>
                        <input type="number" id="wisdomScore" class="score-input" value="10">
                        <input type="text" id="wisdomModifier" class="modifier-input" value="0" readonly>
                    </div>
                    <div class="ability-score">
                        <span class="label">ХАРИЗМА</span>
                        <input type="number" id="charismaScore" class="score-input" value="10">
                        <input type="text" id="charismaModifier" class="modifier-input" value="0" readonly>
                    </div>
                </section>

                <section class="combat-section">
                    <h2>Бой</h2>
                    <div class="ac-initiative-speed">
                        <div class="combat-stat">
                            <span class="label">КД</span>
                            <div id="AC" class="value">13</div>
                        </div>
                        <div class="combat-stat">
                            <span class="label">ИНИЦИАТИВА</span>
                            <div id="INITIATIVE" class="value">0</div>
                        </div>
                        <div class="combat-stat">
                            <span class="label">СКОРОСТЬ</span>
                            <div id="SPEED" class="value">30</div>
                        </div>
                    </div>
                    <div class="hp-section">
                        <span class="label">Максимум хитов</span>
                        <div id="MAX_HP" class="value">8</div>
                        <span class="label">ТЕКУЩИЕ ХИТЫ</span>
                        <div id="CURRENT_HP" class="value">0</div>
                        <span class="label">ВРЕМЕННЫЕ ХИТЫ</span>
                        <div id="TEMP_HP" class="value">0</div>
                    </div>
                </section>

                <section class="proficiency-bonus-section">
                    <h2>Бонус мастерства</h2>
                    <input type="number" id="proficiencyBonus" class="score-input" value="2">
                </section>

                <section class="saving-throws-section">
                    <h2>Спасброски</h2>
                    <ul>
                        <li><input type="checkbox" id="strengthSaveProficient"> <span class="save-value" id="strengthSave">0</span> СИЛА</li>
                        <li><input type="checkbox" id="dexteritySaveProficient"> <span class="save-value" id="dexteritySave">0</span> ЛОВКОСТЬ</li>
                        <li><input type="checkbox" id="constitutionSaveProficient"> <span class="save-value" id="constitutionSave">0</span> ТЕЛОСЛОЖЕНИЕ</li>
                        <li><input type="checkbox" id="intellSaveProficient"> <span class="save-value" id="intellSave">0</span> ИНТЕЛЛЕКТ</li>
                        <li><input type="checkbox" id="wisdomSaveProficient"> <span class="save-value" id="wisdomSave">0</span> МУДРОСТЬ</li>
                        <li><input type="checkbox" id="charismaSaveProficient"> <span class="save-value" id="charismaSave">0</span> ХАРИЗМА</li>
                    </ul>
                </section>

                <section class="skills-section">
                    <h2>Навыки</h2>
                    <ul>
                        <li><input type="checkbox" id="acrobaticsProficient"> <span class="skill-value" id="acrobaticsSkill">0</span> Акробатика (Лов)</li>
                        <li><input type="checkbox" id="animalHandlingProficient"> <span class="skill-value" id="animalHandlingSkill">0</span> Уход за животными (Мдр)</li>
                        <li><input type="checkbox" id="arcanaProficient"> <span class="skill-value" id="arcanaSkill">0</span> Магия (Инт)</li>
                        <li><input type="checkbox" id="athleticsProficient"> <span class="skill-value" id="athleticsSkill">0</span> Атлетика (Сил)</li>
                        <li><input type="checkbox" id="deceptionProficient"> <span class="skill-value" id="deceptionSkill">0</span> Обман (Хар)</li>
                        <li><input type="checkbox" id="historyProficient"> <span class="skill-value" id="historySkill">0</span> История (Инт)</li>
                        <li><input type="checkbox" id="insightProficient"> <span class="skill-value" id="insightSkill">0</span> Проницательность (Мдр)</li>
                        <li><input type="checkbox" id="intimidationProficient"> <span class="skill-value" id="intimidationSkill">0</span> Запугивание (Хар)</li>
                        <li><input type="checkbox" id="investigationProficient"> <span class="skill-value" id="investigationSkill">0</span> Анализ (Инт)</li>
                        <li><input type="checkbox" id="medicineProficient"> <span class="skill-value" id="medicineSkill">0</span> Медицина (Мдр)</li>
                        <li><input type="checkbox" id="natureProficient"> <span class="skill-value" id="natureSkill">0</span> Природа (Инт)</li>
                        <li><input type="checkbox" id="perceptionProficient"> <span class="skill-value" id="perceptionSkill">0</span> Внимательность (Мдр)</li>
                        <li><input type="checkbox" id="performanceProficient"> <span class="skill-value" id="performanceSkill">0</span> Выступление (Хар)</li>
                        <li><input type="checkbox" id="persuasionProficient"> <span class="skill-value" id="persuasionSkill">0</span> Убеждение (Хар)</li>
                        <li><input type="checkbox" id="religionProficient"> <span class="skill-value" id="religionSkill">0</span> Религия (Инт)</li>
                        <li><input type="checkbox" id="sleightOfHandProficient"> <span class="skill-value" id="sleightOfHandSkill">0</span> Ловкость рук (Лов)</li>
                        <li><input type="checkbox" id="stealthProficient"> <span class="skill-value" id="stealthSkill">0</span> Скрытность (Лов)</li>
                        <li><input type="checkbox" id="survivalProficient"> <span class="skill-value" id="survivalSkill">0</span> Выживание (Мдр)</li>
                    </ul>
                </section>

                <section class="features-section">
                    <h2>Умения и Особенности</h2>
                    <div id="featuresList">
                        <h3>Полуэльф:</h3>
                        <ul>
                            <li>Тьмозрение 60 футов</li>
                            <li>Иммунитет к очарованию, устойчивость к усыплению</li>
                            <li>Доп. навыки: Обман, Убеждение</li>
                        </ul>
                        <h3>Волшебник:</h3>
                        <ul>
                            <li>Книга заклинаний (6 заклинаний 1 круга, 3 чары)</li>
                            <li>Подготовка заклинаний: 4</li>
                            <li>Колдовство на Интеллекте</li>
                            <li>Кость хитов: 1к6</li>
                            <li>Магическое восстановление: Один раз в день во время короткого отдыха вы можете восстановить потраченные ячейки заклинаний.</li>
                        </ul>
                        <h3>Магорождённый (Белоснежный дракон):</h3>
                        <ul>
                            <li>Тип урона: холод</li>
                            <li>КД = 13 + мод. Ловкости</li>
                            <li>Макс. хитов +1</li>
                        </ul>
                    </div>
                </section>

                <section class="equipment-section">
                    <h2>Снаряжение</h2>
                    <div id="equipmentList"></div>
                    <button id="addEquipmentBtn">Добавить снаряжение</button>
                </section>

                <section class="spells-section">
                    <h2>Заклинания</h2>
                    <div id="spellsList"></div>
                    <button id="addSpellBtn">Добавить заклинание</button>
                </section>

                <section class="map-section">
                    <h2>Карта Сражения</h2>
                    <div class="map-controls">
                        <label for="gridSize">Размер сетки (px):</label>
                        <input type="number" id="gridSize" value="50">
                        <label for="mapBackground">Фон карты (URL):</label>
                        <input type="text" id="mapBackground" placeholder="URL изображения">
                        <button id="loadMapBackground">Загрузить фон</button>
                        <button id="startCombatBtn">Начать бой</button>
                    </div>
                    
                    <div id="combatTrackerPanel" style="display: none;">
                        <div class="initiative-list-header">
                            <span>Имя</span>
                            <span>Инициатива</span>
                        </div>
                        <ol id="initiativeTracker" class="initiative-list"></ol>
                        <div class="add-npc-form">
                            <input type="text" id="npcNameInput" placeholder="Имя NPC">
                            <input type="number" id="npcInitiativeInput" placeholder="Инициатива">
                            <button id="addNpcBtn">Добавить NPC</button>
                        </div>
                        <div class="combat-controls">
                            <button id="rollInitiativeBtn">Бросить инициативу</button>
                            <button id="nextTurnBtn">Следующий ход</button>
                            <button id="endCombatBtn" class="delete-btn">Завершить бой</button>
                        </div>
                    </div>

                    <canvas id="battleMap" width="800" height="600"></canvas>
                </section>
                
                <section class="event-log-section">
                    <h2>Лог событий</h2>
                    <div id="eventLogDisplay" class="log-display"></div>
                    <div class="log-input-area">
                        <input type="text" id="eventLogInput" placeholder="Введите сообщение или бросок...">
                        <button id="eventLogSendBtn">Отправить</button>
                    </div>
                </section>
            </main>
        </div>
    </div>

    <div id="otherCharacterSheetModal" class="modal-overlay hidden">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <div class="character-sheet" id="otherCharacterSheetContent">
                <header class="sheet-header">
                    <div class="header-section">
                        <span class="label">ИМЯ ПЕРСОНАЖА</span>
                        <input type="text" id="otherCharName" class="character-name-input" readonly>
                    </div>
                    <div class="header-section">
                        <span class="label">КЛАСС И УРОВЕНЬ</span>
                        <p id="otherCharClassLevel"></p>
                    </div>
                    <div class="header-section">
                        <span class="label">ПРЕДЫСТОРИЯ</span>
                        <p id="otherCharBackground"></p>
                    </div>
                    <div class="header-section">
                        <span class="label">ИМЯ ИГРОКА</span>
                        <p id="otherCharPlayerName"></p>
                    </div>
                    <div class="header-section">
                        <span class="label">РАСА</span>
                        <p id="otherCharRace"></p>
                    </div>
                    <div class="header-section">
                        <span class="label">МИРОВОЗЗРЕНИЕ</span>
                        <p id="otherCharAlignment"></p>
                    </div>
                    <div class="header-section">
                        <span class="label">ОЧКИ ОПЫТА</span>
                        <p id="otherCharExperience"></p>
                    </div>
                </header>

                <main class="sheet-main">
                    <section class="abilities-section">
                        <h2>Характеристики</h2>
                        <div class="ability-score">
                            <span class="label">СИЛА</span>
                            <input type="number" id="otherCharStrengthScore" class="score-input" readonly>
                            <input type="text" id="otherCharStrengthModifier" class="modifier-input" readonly>
                        </div>
                        <div class="ability-score">
                            <span class="label">ЛОВКОСТЬ</span>
                            <input type="number" id="otherCharDexterityScore" class="score-input" readonly>
                            <input type="text" id="otherCharDexterityModifier" class="modifier-input" readonly>
                        </div>
                        <div class="ability-score">
                            <span class="label">ТЕЛОСЛОЖЕНИЕ</span>
                            <input type="number" id="otherCharConstitutionScore" class="score-input" readonly>
                            <input type="text" id="otherCharConstitutionModifier" class="modifier-input" readonly>
                        </div>
                        <div class="ability-score">
                            <span class="label">ИНТЕЛЛЕКТ</span>
                            <input type="number" id="otherCharIntellScore" class="score-input" readonly>
                            <input type="text" id="otherCharIntellModifier" class="modifier-input" readonly>
                        </div>
                        <div class="ability-score">
                            <span class="label">МУДРОСТЬ</span>
                            <input type="number" id="otherCharWisdomScore" class="score-input" readonly>
                            <input type="text" id="otherCharWisdomModifier" class="modifier-input" readonly>
                        </div>
                        <div class="ability-score">
                            <span class="label">ХАРИЗМА</span>
                            <input type="number" id="otherCharCharismaScore" class="score-input" readonly>
                            <input type="text" id="otherCharCharismaModifier" class="modifier-input" readonly>
                        </div>
                    </section>

                    <section class="combat-section">
                        <h2>Бой</h2>
                        <div class="ac-initiative-speed">
                            <div class="combat-stat">
                                <span class="label">КД</span>
                                <div id="otherCharAC" class="value"></div>
                            </div>
                            <div class="combat-stat">
                                <span class="label">ИНИЦИАТИВА</span>
                                <div id="otherCharInitiative" class="value"></div>
                            </div>
                            <div class="combat-stat">
                                <span class="label">СКОРОСТЬ</span>
                                <div id="otherCharSpeed" class="value"></div>
                            </div>
                        </div>
                        <div class="hp-section">
                            <span class="label">Максимум хитов</span>
                            <div id="otherCharMaxHP" class="value"></div>
                            <span class="label">ТЕКУЩИЕ ХИТЫ</span>
                            <div id="otherCharCurrentHP" class="value"></div>
                            <span class="label">ВРЕМЕННЫЕ ХИТЫ</span>
                            <div id="otherCharTempHP" class="value"></div>
                        </div>
                    </section>

                    <section class="proficiency-bonus-section">
                        <h2>Бонус мастерства</h2>
                        <input type="number" id="otherCharProficiencyBonus" class="score-input" readonly>
                    </section>

                    <section class="saving-throws-section">
                        <h2>Спасброски</h2>
                        <ul>
                            <li><input type="checkbox" id="otherCharStrengthSaveProficient" disabled> <span class="save-value" id="otherCharStrengthSave"></span> СИЛА</li>
                            <li><input type="checkbox" id="otherCharDexteritySaveProficient" disabled> <span class="save-value" id="otherCharDexteritySave"></span> ЛОВКОСТЬ</li>
                            <li><input type="checkbox" id="otherCharConstitutionSaveProficient" disabled> <span class="save-value" id="otherCharConstitutionSave"></span> ТЕЛОСЛОЖЕНИЕ</li>
                            <li><input type="checkbox" id="otherCharIntellSaveProficient" disabled> <span class="save-value" id="otherCharIntellSave"></span> ИНТЕЛЛЕКТ</li>
                            <li><input type="checkbox" id="otherCharWisdomSaveProficient" disabled> <span class="save-value" id="otherCharWisdomSave"></span> МУДРОСТЬ</li>
                            <li><input type="checkbox" id="otherCharCharismaSaveProficient" disabled> <span class="save-value" id="otherCharCharismaSave"></span> ХАРИЗМА</li>
                        </ul>
                    </section>

                    <section class="skills-section">
                        <h2>Навыки</h2>
                        <ul>
                            <li><input type="checkbox" id="otherCharAcrobaticsProficient" disabled> <span class="skill-value" id="otherCharAcrobaticsSkill"></span> Акробатика (Лов)</li>
                            <li><input type="checkbox" id="otherCharAnimalHandlingProficient" disabled> <span class="skill-value" id="otherCharAnimalHandlingSkill"></span> Уход за животными (Мдр)</li>
                            <li><input type="checkbox" id="otherCharArcanaProficient" disabled> <span class="skill-value" id="otherCharArcanaSkill"></span> Магия (Инт)</li>
                            <li><input type="checkbox" id="otherCharAthleticsProficient" disabled> <span class="skill-value" id="otherCharAthleticsSkill"></span> Атлетика (Сил)</li>
                            <li><input type="checkbox" id="otherCharDeceptionProficient" disabled> <span class="skill-value" id="otherCharDeceptionSkill"></span> Обман (Хар)</li>
                            <li><input type="checkbox" id="otherCharHistoryProficient" disabled> <span class="skill-value" id="otherCharHistorySkill"></span> История (Инт)</li>
                            <li><input type="checkbox" id="otherCharInsightProficient" disabled> <span class="skill-value" id="otherCharInsightSkill"></span> Проницательность (Мдр)</li>
                            <li><input type="checkbox" id="otherCharIntimidationProficient" disabled> <span class="skill-value" id="otherCharIntimidationSkill"></span> Запугивание (Хар)</li>
                            <li><input type="checkbox" id="otherCharInvestigationProficient" disabled> <span class="skill-value" id="otherCharInvestigationSkill"></span> Анализ (Инт)</li>
                            <li><input type="checkbox" id="otherCharMedicineProficient" disabled> <span class="skill-value" id="otherCharMedicineSkill"></span> Медицина (Мдр)</li>
                            <li><input type="checkbox" id="otherCharNatureProficient" disabled> <span class="skill-value" id="otherCharNatureSkill"></span> Природа (Инт)</li>
                            <li><input type="checkbox" id="otherCharPerceptionProficient" disabled> <span class="skill-value" id="otherCharPerceptionSkill"></span> Внимательность (Мдр)</li>
                            <li><input type="checkbox" id="otherCharPerformanceProficient" disabled> <span class="skill-value" id="otherCharPerformanceSkill"></span> Выступление (Хар)</li>
                            <li><input type="checkbox" id="otherCharPersuasionProficient" disabled> <span class="skill-value" id="otherCharPersuasionSkill"></span> Убеждение (Хар)</li>
                            <li><input type="checkbox" id="otherCharReligionProficient" disabled> <span class="skill-value" id="otherCharReligionSkill"></span> Религия (Инт)</li>
                            <li><input type="checkbox" id="otherCharSleightOfHandProficient" disabled> <span class="skill-value" id="otherCharSleightOfHandSkill"></span> Ловкость рук (Лов)</li>
                            <li><input type="checkbox" id="otherCharStealthProficient" disabled> <span class="skill-value" id="otherCharStealthSkill"></span> Скрытность (Лов)</li>
                            <li><input type="checkbox" id="otherCharSurvivalProficient" disabled> <span class="skill-value" id="otherCharSurvivalSkill"></span> Выживание (Мдр)</li>
                        </ul>
                    </section>

                    <section class="features-section">
                        <h2>Умения и Особенности</h2>
                        <div id="otherCharFeaturesList"></div>
                    </section>

                    <section class="equipment-section">
                        <h2>Снаряжение</h2>
                        <div id="otherCharEquipmentList"></div>
                    </section>

                    <section class="spells-section">
                        <h2>Заклинания</h2>
                        <div id="otherCharSpellsList"></div>
                    </section>
                </main>
            </div>
        </div>
    </div>

    <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
    <script src="js/main.js"></script>
</body>
</html>