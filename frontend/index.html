<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>D&D Companion</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
</head>
<body>

    <div id="auth-container" class="auth-overlay">
        <div class="auth-form-container">
            <form id="login-form">
                <h2>Вход в D&D Companion</h2>
                <input type="text" id="loginUsername" placeholder="Имя пользователя" autocomplete="username" required>
                <input type="password" id="loginPassword" placeholder="Пароль" autocomplete="current-password" required>
                <button id="loginBtn" type="submit">Войти</button>
                <p>Нет аккаунта? <a href="#" id="showRegister">Зарегистрироваться</a></p>
            </form>
            <form id="register-form" class="hidden">
                <h2>Регистрация</h2>
                <input type="text" id="registerUsername" placeholder="Имя пользователя" autocomplete="username" required>
                <input type="password" id="registerPassword" placeholder="Пароль" autocomplete="new-password" required>
                <button id="registerBtn" type="submit">Создать аккаунт</button>
                <p>Уже есть аккаунт? <a href="#" id="showLogin">Войти</a></p>
            </form>
            <p id="authMessage" class="auth-message"></p>
        </div>
    </div>

    <div id="main-app" class="hidden">
        <aside class="sidebar left-sidebar">
            <div id="combat-tracker" class="sidebar-panel">
                <h3>Бой</h3>
                <div id="combat-controls">
                    <button id="startCombatBtn">Начать бой</button>
                    <button id="nextTurnBtn" class="hidden">След. ход</button>
                    <button id="endCombatBtn" class="hidden">Завершить</button>
                </div>
                <ul id="initiativeTracker"></ul>
                <div id="add-npc-form" class="hidden">
                    <input type="text" id="npcNameInput" placeholder="Имя NPC">
                    <input type="number" id="npcMaxHpInput" placeholder="HP" style="width: 60px;">
                    <input type="number" id="npcACInput" placeholder="AC" style="width: 60px;">
                    <input type="number" id="npcInitiativeInput" placeholder="Init" style="width: 60px;">
                    <button id="addNpcBtn">+</button>
                </div>
            </div>
            
            <div id="dice-roller-panel" class="sidebar-panel">
                <h3>Бросок кубиков</h3>
                <div id="dice-result-display">-</div>
                <div id="dice-buttons">
                    <button data-dice="d4">d4</button>
                    <button data-dice="d6">d6</button>
                    <button data-dice="d8">d8</button>
                    <button data-dice="d10">d10</button>
                    <button data-dice="d12">d12</button>
                    <button data-dice="d20">d20</button>
                    <button data-dice="d100">d100</button>
                </div>
                <div id="dice-actions">
                    <button id="roll-dice-btn">Бросить</button>
                    <input type="number" id="manual-roll-input" placeholder="Вручную">
                </div>
            </div>
        </aside>

        <main class="main-content">
            <div id="map-container">
                <canvas id="mainCanvas"></canvas>
            </div>
            
            <div id="action-bar">
            </div>

            <div id="map-toolbar">
                <div id="world-map-gm-controls" class="toolbar-group hidden">
                    <label for="worldMapBackgroundUrl">URL карты мира:</label>
                    <input type="text" id="worldMapBackgroundUrl" placeholder="https://example.com/world_map.jpg">
                    <button id="saveWorldMapBtn">Загрузить</button>
                </div>

                 <div id="user-panel">
                    <span id="usernameDisplay"></span>
                    <button id="logoutBtn">Выйти</button>
                </div>
            </div>
        </main>

        <aside class="sidebar right-sidebar">
            <div id="character-manager" class="sidebar-panel">
                <h3>Персонажи</h3>
                <div class="custom-select-wrapper">
                    <div id="characterSelectorTrigger" class="custom-select-trigger">
                        <span>-- Выберите персонажа --</span>
                        <div class="arrow"></div>
                    </div>
                    <div id="characterSelectorOptions" class="custom-select-options">
                        </div>
                </div>
                <div class="character-actions">
                    <div class="char-icon-buttons">
                        <button id="loadCharacterBtn" class="icon-btn" title="Загрузить персонажа">↓</button>
                        <button id="newCharacterBtn" class="icon-btn" title="Создать нового персонажа">+</button>
                        <button id="deleteCharacterBtn" class="icon-btn delete-btn" title="Удалить персонажа">×</button>
                    </div>
                    <button id="open-sheet-btn" class="sheet-btn">Лист персонажа</button>
                </div>
            </div>

            <div id="event-log" class="sidebar-panel">
                <h3>Лог событий</h3>
                <div id="eventLogDisplay"></div>
                <div class="log-input-area">
                    <input type="text" id="eventLogInput" placeholder="Сообщение или /roll 1d20">
                    <button id="eventLogSendBtn">➢</button>
                </div>
            </div>
        </aside>
    </div>

    <div id="sheet-modal" class="modal-overlay hidden">
        <div class="sheet-modal-content">
            <button id="close-sheet-btn" class="close-btn">&times;</button>
            <div id="character-sheet-container"></div>
        </div>
    </div>
    
    <div id="item-info-modal" class="modal-overlay hidden">
        <div class="info-modal-content">
            <button class="close-info-modal-btn">&times;</button>
            <h3 id="info-modal-title"></h3>
            <p id="info-modal-description"></p>
        </div>
    </div>

    <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
    <script src="js/main.js"></script>
</body>
</html>